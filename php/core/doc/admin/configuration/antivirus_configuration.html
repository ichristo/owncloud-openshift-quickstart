
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Configuring the ClamAV Antivirus Scanner &mdash; ownCloud Administrators Manual 7.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '7.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <link rel="top" title="ownCloud Administrators Manual 7.0 documentation" href="../index.html" />
    <link rel="up" title="Configuration" href="index.html" />
    <link rel="next" title="Automatic Configuration Setup" href="automatic_configuration.html" />
    <link rel="prev" title="Configuration" href="index.html" />
<script type="text/javascript">
(function () {
  /**
   * Patch TOC list.
   *
   * Will mutate the underlying span to have a correct ul for nav.
   *
   * @param $span: Span containing nested UL's to mutate.
   * @param minLevel: Starting level for nested lists. (1: global, 2: local).
   */
  var patchToc = function ($ul, minLevel) {
    var findA;

    // Find all a "internal" tags, traversing recursively.
    findA = function ($elem, level) {
      var level = level || 0,
        $items = $elem.find("> li > a.internal, > ul, > li > ul");

      // Iterate everything in order.
      $items.each(function (index, item) {
        var $item = $(item),
          tag = item.tagName.toLowerCase(),
          pad = 15 + ((level - minLevel) * 10);

        if (tag === 'a' && level >= minLevel) {
          // Add to existing padding.
          $item.css('padding-left', pad + "px");
          console.log(level, $item, 'padding-left', pad + "px");
        } else if (tag === 'ul') {
          // Recurse.
          findA($item, level + 1);
        }
      });
    };

    console.log("HERE");
    findA($ul);
  };

  $(document).ready(function () {
    // Add styling, structure to TOC's.
    $(".dropdown-menu").each(function () {
      $(this).find("ul").each(function (index, item){
        var $item = $(item);
        $item.addClass('unstyled');
      });
      $(this).find("li").each(function () {
        $(this).parent().append(this);
      });
    });

    // Patch in level.
    patchToc($("ul.globaltoc"), 2);
    patchToc($("ul.localtoc"), 2);

    // Enable dropdown.
    $('.dropdown-toggle').dropdown();
  });
}());
</script>

  </head>
  <body>
  

<div class="container">
  <div class="content">
    <div class="page-header">
      <h1><a href="../contents.html">ownCloud Administrators Manual</a></h1>

    </div>
    
			<div class="row">
				<div class="span3">
					<div class="sidebar">
						<div class="well">
							<div class="menu-support-container">
								<ul id="menu-support" class="menu">
									<ul>
										<li><a href="../contents.html">Overview</a></li>
									</ul>
                  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Introduction</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../whats_new_admin.html">What&#8217;s New for Admins in ownCloud 7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Configuration</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="">Configuring the ClamAV Antivirus Scanner</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installing-clamav">Installing ClamAV</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enabling-the-antivirus-app-for-files">Enabling the Antivirus App for Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-clamav-on-owncloud">Configuring ClamAV on ownCloud</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="automatic_configuration.html">Automatic Configuration Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="background_jobs_configuration.html">Defining Background Jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="big_file_upload_configuration.html">Uploading big files &gt; 512MB (as set by default)</a></li>
<li class="toctree-l2"><a class="reference internal" href="collaborative_documents_configuration.html">Configuring the Collaborative Documents App</a></li>
<li class="toctree-l2"><a class="reference internal" href="collaborative_documents_configuration.html#enabling-the-documents-app">Enabling the Documents App</a></li>
<li class="toctree-l2"><a class="reference internal" href="config_sample_php_parameters.html">Config.php Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom_client_configuration.html">Custom Client Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="database_configuration.html">Database Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="email_configuration.html">Email Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="encryption_configuration.html">Encryption Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="external_storage_configuration_gui.html">Configuring External Storage (GUI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="external_storage_configuration.html">Configuring External Storage (Configuration File)</a></li>
<li class="toctree-l2"><a class="reference internal" href="file_sharing_configuration.html">File Sharing</a></li>
<li class="toctree-l2"><a class="reference internal" href="files_locking_enabling.html">Files Locking App Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="js_css_asset_management_configuration.html">JavaScript and CSS Asset Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="knowledgebase_configuration.html">Knowledge Base Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="language_configuration.html">Language Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging_configuration.html">Logging Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="previews_configuration.html">Previews Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="reverse_proxy_configuration.html">Reverse Proxy Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="search_configuration.html">Enabling Full-Text Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="server_to_server_configuration.html">Configuring Server-to-Server Sharing</a></li>
<li class="toctree-l2"><a class="reference internal" href="serving_static_files_configuration.html">Serving Static Files for Better Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="thirdparty_php_configuration.html">Using Third Party PHP Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_auth_ftp_smb_imap.html">User Authentication with IMAP, SMB, and FTP</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_auth_ldap.html">User Authentication with LDAP</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_configuration.html">User Management</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../maintenance/index.html">Maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/index.html">Issues</a></li>
</ul>

								</ul>
							</div>
						</div>
					</div>
				</div>
        

				<div class="span9">
					<div class="page-content">
						
  <div class="section" id="configuring-the-clamav-antivirus-scanner">
<h1>Configuring the ClamAV Antivirus Scanner<a class="headerlink" href="#configuring-the-clamav-antivirus-scanner" title="Permalink to this headline">¶</a></h1>
<p>You can configure your ownCloud server to automatically run a virus scan on
newly-uploaded files with the Antivirus App for Files. The Antivirus App for
Files integrates the open source anti-virus engine <a class="reference external" href="http://www.clamav.net/index.html">ClamAV</a>  with ownCloud. ClamAV detects all forms
of malware including Trojan horses, viruses, and worms, and it operates on all
major file types including Windows, Linux, and Mac files, compressed files,
executables, image files, Flash, PDF, and many others. ClamAV&#8217;s Freshclam
daemon automatically updates its malware signature database at scheduled
intervals.</p>
<p>ClamAV runs on Linux and any Unix-type operating system, and Microsoft Windows.
However, it has only been tested with ownCloud on Linux, so these instructions
are for Linux systems. You must first install ClamAV, and then install and
configure the Antivirus App for Files on ownCloud.</p>
<div class="section" id="installing-clamav">
<h2>Installing ClamAV<a class="headerlink" href="#installing-clamav" title="Permalink to this headline">¶</a></h2>
<p>As always, the various Linux distributions manage installing and configuring
ClamAV in different ways.</p>
<dl class="docutils">
<dt>Debian, Ubuntu, Linux Mint</dt>
<dd><p class="first">On Debian and Ubuntu systems, and their many variants, install ClamAV with
these commands:</p>
<div class="last highlight-python"><pre>apt-get install clamav clamav-daemon</pre>
</div>
</dd>
</dl>
<p>The installer automatically creates default configuration files and launches the
<tt class="docutils literal"><span class="pre">clamd</span></tt> and <tt class="docutils literal"><span class="pre">freshclam</span></tt> daemons. You don&#8217;t have to do anything more, though
it&#8217;s a good idea to review the ClamAV documentation and your settings in
<tt class="docutils literal"><span class="pre">/etc/clamav/</span></tt>. Enable verbose logging in both <tt class="docutils literal"><span class="pre">clamd.conf</span></tt> and
<tt class="docutils literal"><span class="pre">freshclam.conf</span></tt> until you get any kinks worked out.</p>
<dl class="docutils">
<dt>Red Hat 7, CentOS 7</dt>
<dd><p class="first">On Red Hat 7 and related systems you must install the Extra Packages for
Enterprise Linux (EPEL) repository, and then install ClamAV:</p>
<div class="last highlight-python"><pre>yum install epel-release
yum install clamav clamav-scanner clamav-scanner-systemd clamav-server
clamav-server-systemd clamav-update</pre>
</div>
</dd>
</dl>
<p>This installs two configuration files: <tt class="docutils literal"><span class="pre">/etc/freshclam.conf</span></tt> and
<tt class="docutils literal"><span class="pre">/etc/clamd.d/scan.conf</span></tt>. You must edit both of these before you can run
ClamAV. Both files are well-commented, and <tt class="docutils literal"><span class="pre">man</span> <span class="pre">clamd.conf</span></tt> and <tt class="docutils literal"><span class="pre">man</span>
<span class="pre">freshclam.conf</span></tt> explain all the options.  Refer to <tt class="docutils literal"><span class="pre">/etc/passwd</span></tt> and
<tt class="docutils literal"><span class="pre">/etc/group</span></tt> when you need to verify the ClamAV user and group.</p>
<p>First edit <tt class="docutils literal"><span class="pre">/etc/freshclam.conf</span></tt> and configure your options.
<tt class="docutils literal"><span class="pre">freshclam</span></tt> updates your malware database, so you want it to run frequently to
get updated malware signatures. Run it manually post-installation to download
your first set of malware signatures:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">freshclam</span>
</pre></div>
</div>
<p>The EPEL packages do not include an init file for <tt class="docutils literal"><span class="pre">freshclam</span></tt>, so the quick
and easy way to set it up for regular checks is with a cron job. This example
runs it every hour at 47 minutes past the hour:</p>
<div class="highlight-python"><pre># m   h  dom mon dow  command
  47  *  *   *    *  /usr/bin/freshclam --quiet</pre>
</div>
<p>Please avoid any multiples of 10, because those are when the ClamAV servers are
hit the hardest for updates.</p>
<p>Next, edit <tt class="docutils literal"><span class="pre">/etc/clamd.d/scan.conf</span></tt>. When you&#8217;re finished you must enable
the <tt class="docutils literal"><span class="pre">clamd</span></tt> service file and start <tt class="docutils literal"><span class="pre">clamd</span></tt>:</p>
<div class="highlight-python"><pre>systemctl enable clamd@scan.service
systemctl start clamd@scan.service</pre>
</div>
<p>That should take care of everything. Enable verbose logging in <tt class="docutils literal"><span class="pre">scan.conf</span></tt>
and <tt class="docutils literal"><span class="pre">freshclam.conf</span></tt> until it is running the way you want.</p>
</div>
<div class="section" id="enabling-the-antivirus-app-for-files">
<h2>Enabling the Antivirus App for Files<a class="headerlink" href="#enabling-the-antivirus-app-for-files" title="Permalink to this headline">¶</a></h2>
<p>Simply go to your ownCloud Apps page to enable it.</p>
<div class="figure">
<img alt="../_images/antivirus-app.png" src="../_images/antivirus-app.png" />
</div>
</div>
<div class="section" id="configuring-clamav-on-owncloud">
<h2>Configuring ClamAV on ownCloud<a class="headerlink" href="#configuring-clamav-on-owncloud" title="Permalink to this headline">¶</a></h2>
<p>Next, go to your ownCloud Admin page and set your ownCloud logging level to
Everything.</p>
<div class="figure">
<img alt="../_images/antivirus-logging.png" src="../_images/antivirus-logging.png" />
</div>
<p>Now find your Antivirus Configuration panel on your Admin page.</p>
<div class="figure">
<img alt="../_images/antivirus-config.png" src="../_images/antivirus-config.png" />
</div>
<p>ClamAV runs in one of three modes:</p>
<ul class="simple">
<li>Daemon (Socket): ClamAV is running on the same server as ownCloud. The ClamAV
daemon, <tt class="docutils literal"><span class="pre">clamd</span></tt>, runs in the background. When there is no activity <tt class="docutils literal"><span class="pre">clamd</span></tt>
places a minimal load on your system. If your users upload large volumes of
files you will see high CPU usage.</li>
<li>Daemon: ClamAV is running on a different server. This is a good option
for ownCloud servers with high volumes of file uploads.</li>
<li>Executable: ClamAV is running on the same server as ownCloud, and the
<tt class="docutils literal"><span class="pre">clamscan</span></tt> command is started and then stopped with each file upload.
<tt class="docutils literal"><span class="pre">clamscan</span></tt> is slow and not always reliable for on-demand usage; it is
better to use one of the daemon modes.</li>
</ul>
<dl class="docutils">
<dt>Daemon (Socket)</dt>
<dd><p class="first">ownCloud should detect your <tt class="docutils literal"><span class="pre">clamd</span></tt> socket and fill in the <tt class="docutils literal"><span class="pre">Socket</span></tt>
field. This is the <tt class="docutils literal"><span class="pre">LocalSocket</span></tt> option in <tt class="docutils literal"><span class="pre">clamd.conf</span></tt>. You can
run <tt class="docutils literal"><span class="pre">netstat</span></tt> to verify:</p>
<div class="highlight-python"><pre>netstat -a|grep clam
unix 2 [ ACC ] STREAM LISTENING 15857 /var/run/clamav/clamd.ctl</pre>
</div>
<div class="figure">
<img alt="../_images/antivirus-daemon-socket.png" src="../_images/antivirus-daemon-socket.png" />
</div>
<p>The <tt class="docutils literal"><span class="pre">Stream</span> <span class="pre">Length</span></tt> value sets the number of bytes read in one pass.
10485760 bytes, or ten megabytes, is the default. This value should be
no larger than the PHP <tt class="docutils literal"><span class="pre">memory_limit</span></tt> settings, or physical memory if
<tt class="docutils literal"><span class="pre">memory_limit</span></tt> is set to -1 (no limit).</p>
<p class="last"><tt class="docutils literal"><span class="pre">Action</span> <span class="pre">for</span> <span class="pre">infected</span> <span class="pre">files</span> <span class="pre">found</span> <span class="pre">while</span> <span class="pre">scanning</span></tt> gives you the choice of
logging any alerts without deleting the files, or immediately deleting
infected files.</p>
</dd>
<dt>Daemon</dt>
<dd><p class="first">For the Daemon option you need the hostname or IP address of the remote
server running ClamAV, and the server&#8217;s port number.</p>
<div class="last figure">
<img alt="../_images/antivirus-daemon-socket.png" src="../_images/antivirus-daemon-socket.png" />
</div>
</dd>
<dt>Executable</dt>
<dd><p class="first">The Executable option requires the path to <tt class="docutils literal"><span class="pre">clamscan</span></tt>, which is the
interactive ClamAV scanning command. ownCloud should find it automatically.</p>
<div class="last figure">
<img alt="../_images/antivirus-executable.png" src="../_images/antivirus-executable.png" />
</div>
</dd>
</dl>
<p>When you are satisfied with how ClamAV is operating, you might want to go
back and change all of your logging to less verbose levels.</p>
</div>
</div>


					</div>
				</div>
			</div>
    
  </div>
</div>
  </body>
</html>